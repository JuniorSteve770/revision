import React, { useState, useEffect } from "react";
import "./QCMStyles.css";

// Flashcards pour le niveau basic
const basicSlides = [
    
   {
    "question": "1. Compr√©hension du M√©tier (Equity / Front Office)",
    "answer": "."
  },
  {
    "question": "Pouvez-vous expliquer le fonctionnement des march√©s actions ?",
    "answer": "Les march√©s actions permettent aux entreprises de lever des fonds en √©mettant des titres, et aux investisseurs d‚Äôacheter/vendre ces titres sur des march√©s organis√©s comme Euronext ou le NYSE."
  },
  {
    "question": "Quelle est la diff√©rence entre un ordre au march√© et un ordre limite ?",
    "answer": "Un ordre au march√© est ex√©cut√© imm√©diatement au meilleur prix disponible, tandis qu‚Äôun ordre limite est ex√©cut√© uniquement si le prix atteint une limite d√©finie par l‚Äôinvestisseur."
  },
  {
    "question": "Que savez-vous des produits Equity d√©riv√©s (options, futures, turbos‚Ä¶) ?",
    "answer": "Ce sont des instruments financiers d√©riv√©s d‚Äôactions sous-jacentes, utilis√©s pour se couvrir, sp√©culer ou optimiser un portefeuille. Ils incluent options, futures, turbos, warrants, etc."
  },
  {
    "question": "Quelle est la diff√©rence entre le cash equity et les produits structur√©s ?",
    "answer": "Le cash equity concerne l‚Äôachat/vente d‚Äôactions classiques. Les produits structur√©s combinent plusieurs instruments (souvent des d√©riv√©s) pour cr√©er des profils de rendement sp√©cifiques."
  },
  {
    "question": "Comment les traders utilisent-ils les syst√®mes Front Office au quotidien ?",
    "answer": "Ils les utilisent pour consulter les prix, ex√©cuter des ordres, analyser le carnet d‚Äôordres, visualiser les risques, suivre les positions et consulter les news ou donn√©es de march√©."
  },
  {
    "question": "Avez-vous d√©j√† travaill√© avec des desks actions ou des sales/traders ?",
    "answer": "Oui, j‚Äôai particip√© √† des ateliers pour recueillir leurs besoins, suivi des incidents avec eux en production et contribu√© √† l‚Äô√©volution des outils de pricing ou de passage d‚Äôordres."
  },
  {
    "question": "Comment assurez-vous la prise en compte de la r√©glementation (MiFID II, etc.) dans vos projets ?",
    "answer": "En int√©grant les contraintes r√©glementaires d√®s le cadrage (reporting TCA, best execution, horodatage) et en collaborant avec les √©quipes conformit√© et juridiques."
  },
    {
    "question": " 2. Questions de R√¥le BA (Sp√©cifiques au Front Office)",
    "answer": "üß©"
  },
  {
    "question": "Comment recueillez-vous les besoins m√©tier aupr√®s des traders ou sales ?",
    "answer": "Je privil√©gie les √©changes directs via ateliers, interviews, observation sur le floor et analyse des incidents ou usages r√©currents."
  },
  {
    "question": "Quelle m√©thodologie utilisez-vous pour r√©diger vos sp√©cifications fonctionnelles (UML, user stories, etc.) ?",
    "answer": "Je m‚Äôadapte : user stories et crit√®res d‚Äôacceptation en Agile, UML ou BPMN pour les processus plus complexes, et matrice de besoins pour les projets structur√©s."
  },
  {
    "question": "Avez-vous d√©j√† mod√©lis√© des workflows de trading ou d‚Äôex√©cution ?",
    "answer": "Oui, j‚Äôai utilis√© des diagrammes de s√©quence ou de flux pour repr√©senter les √©tapes cl√©s entre l‚Äôordre, le matching, l‚Äôex√©cution, l‚Äôalerte et le reporting."
  },
  {
    "question": "Comment g√©rez-vous les priorit√©s entre plusieurs utilisateurs Front Office ?",
    "answer": "Je fais une qualification des impacts, fr√©quence et criticit√©, puis je priorise en lien avec les Product Owners ou les responsables de desk."
  },
  {
    "question": "Quelle est votre approche pour tester une fonctionnalit√© sur un outil de pricing ou de passage d‚Äôordre ?",
    "answer": "Je d√©finis des cas de test m√©tiers, des jeux de donn√©es r√©alistes et je valide les r√©sultats avec les utilisateurs cl√©s en environnement de pr√©production."
  },
  {
    "question": "Avez-vous particip√© √† des phases de recette avec le Front Office ?",
    "answer": "Oui, en coordonnant les tests UAT avec les sales/traders, en r√©digeant les plans de test et en centralisant les retours sur anomalies ou ergonomie."
  },
  {
    "question": "Comment identifiez-vous et documentez-vous les impacts d‚Äôun changement sur une cha√Æne Front to Back ?",
    "answer": "Je cartographie le flux m√©tier complet, du Front (saisie de l‚Äôordre) au Back (r√®glement/livraison) et j‚Äôidentifie les d√©pendances applicatives ou humaines."
  },
  {
    "question": " 3. Comp√©tences Techniques",
    "answer": "üíª"
  },
  
  {
    "question": "Travaillez-vous avec des outils comme Bloomberg, Reuters, Fidessa, Murex ou Calypso ?",
    "answer": "Oui, je ma√Ætrise l‚Äôenvironnement Bloomberg pour les prix, les ordres et les news. J‚Äôai aussi eu des interactions avec Calypso sur les flux de d√©riv√©s."
  },
  {
    "question": "Connaissez-vous le langage FIX ? Avez-vous d√©j√† analys√© un message FIX ?",
    "answer": "Oui, j‚Äôai analys√© des messages FIX pour tracer des ordres (tag 35, 55, etc.) et investiguer des bugs d‚Äôex√©cution ou de booking dans les logs."
  },
  {
    "question": "Savez-vous lire ou √©crire des requ√™tes SQL pour valider des donn√©es ?",
    "answer": "Oui, j‚Äôutilise r√©guli√®rement SQL pour valider des donn√©es, reconstruire un trade ou v√©rifier des √©carts entre syst√®mes Front et Back."
  },
  {
    "question": "Avez-vous d√©j√† utilis√© des outils de BI (Power BI, Tableau) pour produire des reportings ?",
    "answer": "Oui, notamment pour suivre les KPIs d‚Äôactivit√© des desks, analyser les anomalies ou agr√©ger des donn√©es de performance ou de risque."
  },
  {
    "question": "Quels outils utilisez-vous pour suivre les demandes (JIRA, Confluence‚Ä¶) ?",
    "answer": "JIRA pour le suivi Agile des user stories et Confluence pour la documentation fonctionnelle, les workflows et les comptes-rendus d‚Äôateliers."
  },
  {
    "question": "Avez-vous contribu√© √† des projets Agile ? Quel √©tait votre r√¥le dans les sprints ?",
    "answer": "Oui, en tant que BA, je r√©digeais les user stories, participais aux plannings, revues et r√©trospectives, et validais les livrables avec les PO et utilisateurs."
  },
  {
    "question": "4. Probl√®mes Concrets et √âtudes de Cas",
    "answer": "üíª"
  },
   {
    "question": "Un trader se plaint que les prix affich√©s sur l‚Äôoutil de pricing ne sont pas √† jour. Que faites-vous ?",
    "answer": "Je v√©rifie la source de donn√©es (ex : Bloomberg, feed interne), teste le flux en temps r√©el, consulte les logs et alerte si besoin les √©quipes techniques."
  },
  {
    "question": "Un utilisateur ne retrouve pas un trade ex√©cut√©. Comment analysez-vous le probl√®me ?",
    "answer": "Je reconstitue le parcours du trade dans le syst√®me, v√©rifie les statuts, consulte les logs, les tables SQL et les √©ventuels rejets ou erreurs d‚Äôenrichissement."
  },
  {
    "question": "Comment structureriez-vous un projet de refonte d‚Äôun outil d‚Äôordre Front Office ?",
    "answer": "Je commence par recueillir les besoins utilisateurs, cartographier les flux existants, prioriser les fonctionnalit√©s cl√©s, puis d√©finir les phases MVP, tests et d√©ploiement progressif."
  },
  {
    "question": "Donnez un exemple o√π vous avez d√ª faire le lien entre MOA, MOE et le Front Office pour r√©soudre un incident critique.",
    "answer": "Lors d‚Äôun incident de pricing erron√© en salle des march√©s, j‚Äôai analys√© les logs, confirm√© le bug avec la MOE, s√©curis√© temporairement les flux, puis organis√© la correction en urgence avec les traders."
  },
  {
    "question": "Vous devez int√©grer un nouveau flux de donn√©es de march√© dans l‚Äôoutil de pricing. Quelles sont les √©tapes cl√©s ?",
    "answer": "Analyser le format du flux, valider sa fr√©quence et sa qualit√©, d√©finir le mapping vers le syst√®me cible, coordonner le d√©veloppement avec la MOE, tester avec les utilisateurs et monitorer apr√®s mise en production."
  },
        {
    "question": " 5. Soft Skills & Communication",
    "answer": "üíª"
  },
  {
    "question": "Comment g√©rez-vous une situation o√π le trader attend une solution imm√©diate mais la DSI vous demande du d√©lai ?",
    "answer": "Je priorise la transparence : j‚Äôexplique les contraintes techniques, propose une solution interm√©diaire ou un workaround, tout en relayant l‚Äôurgence √† la DSI."
  },
  {
    "question": "Quelle est votre approche pour vulgariser des contraintes techniques aupr√®s du Front Office ?",
    "answer": "Je fais des analogies concr√®tes, utilise des sch√©mas simples et me concentre sur les impacts m√©tier plut√¥t que les d√©tails techniques."
  },
  {
    "question": "Comment construisez-vous une relation de confiance avec les utilisateurs Front ?",
    "answer": "En √©tant r√©actif, en comprenant leurs contraintes m√©tier, en tenant mes engagements et en communiquant r√©guli√®rement sur l‚Äôavancement ou les incidents."
  },
  {
    "question": "Donnez un exemple o√π vous avez contribu√© √† la prise de d√©cision fonctionnelle en salle des march√©s.",
    "answer": "Lors du choix d‚Äôun module d‚Äôex√©cution rapide, j‚Äôai organis√© une d√©mo, compar√© les options et r√©dig√© une synth√®se claire qui a permis au desk de trancher rapidement."
  },

];

// QCM pour les niveaux moyen et avanc√©
const questions = {
  moyen: [
{
    "question": "Quelle est l‚Äôinteraction cl√© entre le BA et le Front Office lors de la phase de cadrage d‚Äôun projet ?",
    "options": [
      "Le BA observe uniquement les op√©rations du Front Office",
      "Le BA r√©dige des user stories sans √©change direct",
      "Le BA recueille les besoins via ateliers et observation sur le floor",
      "Le BA d√©l√®gue la collecte des besoins √† la MOE"
    ],
    "answer": "Le BA recueille les besoins via ateliers et observation sur le floor",
    "explanation": "Le BA privil√©gie les interactions directes avec les traders et sales via ateliers, interviews et observation pour bien comprendre les besoins m√©tier."
  },
  {
    "question": "Quel est le r√¥le du BA dans la priorisation des demandes des utilisateurs Front Office ?",
    "options": [
      "Il suit un ordre chronologique de r√©ception des demandes",
      "Il demande aux d√©veloppeurs de choisir",
      "Il √©value impact, fr√©quence et criticit√© pour arbitrer",
      "Il laisse les utilisateurs d√©cider eux-m√™mes"
    ],
    "answer": "Il √©value impact, fr√©quence et criticit√© pour arbitrer",
    "explanation": "Le BA analyse la valeur m√©tier et la fr√©quence des demandes pour les prioriser avec les Product Owners ou responsables de desks."
  },
  {
    "question": "Quelle action le BA entreprend-il pour tester une nouvelle fonctionnalit√© de pricing ?",
    "options": [
      "Il demande √† la MOE de tester seule",
      "Il cr√©e des cas de test r√©alistes et valide avec les utilisateurs",
      "Il attend que le client signale un bug",
      "Il teste en production sans jeu de donn√©es"
    ],
    "answer": "Il cr√©e des cas de test r√©alistes et valide avec les utilisateurs",
    "explanation": "Le BA d√©finit des cas m√©tiers, pr√©pare des jeux de donn√©es et s‚Äôassure de la validation fonctionnelle en pr√©-production avec les utilisateurs cl√©s."
  },
  {
    "question": "Quelle est la meilleure r√©ponse √† une incoh√©rence entre un prix affich√© sur l‚Äôoutil FO et la donn√©e r√©elle ?",
    "options": [
      "Red√©marrer l‚Äôapplication",
      "Demander aux traders de patienter",
      "Analyser les flux de donn√©es, logs et source (ex: Bloomberg)",
      "Attendre le retour de la DSI"
    ],
    "answer": "Analyser les flux de donn√©es, logs et source (ex: Bloomberg)",
    "explanation": "Le BA doit identifier l'origine du probl√®me via les flux de donn√©es, v√©rifier la source et analyser les logs avant d‚Äôalerter les √©quipes techniques."
  },
  {
    "question": "Quelle attitude adopter face √† un trader qui exige une solution imm√©diate alors que la DSI pr√©voit un d√©lai ?",
    "options": [
      "Promettre une r√©solution rapide sans validation",
      "Proposer une solution interm√©diaire et alerter la DSI",
      "Ignorer la demande du trader",
      "Transf√©rer la demande √† un autre BA"
    ],
    "answer": "Proposer une solution interm√©diaire et alerter la DSI",
    "explanation": "Le BA doit g√©rer la pression en proposant un workaround, en maintenant une communication claire, et en impliquant rapidement la DSI."
  }
  ],
  avance: [
     {
    "question": "Quelle est la diff√©rence principale entre la variance et l‚Äô√©cart-type en finance ?",
    "options": [
      "La variance est toujours plus petite que l‚Äô√©cart-type",
      "L‚Äô√©cart-type est une moyenne absolue, la variance est une moyenne quadratique",
      "La variance s‚Äôexprime dans les m√™mes unit√©s que les donn√©es",
      "L‚Äô√©cart-type s‚Äôexprime dans les m√™mes unit√©s que les donn√©es, la variance est au carr√©"
    ],
    "answer": "L‚Äô√©cart-type s‚Äôexprime dans les m√™mes unit√©s que les donn√©es, la variance est au carr√©",
    "explanation": "L‚Äô√©cart-type est la racine carr√©e de la variance et a la m√™me unit√© que les donn√©es, ce qui le rend plus interpr√©table pour mesurer le risque."
  },
  {
    "question": "Pourquoi le processus de Wiener est-il central dans les mod√®les de finance quantitative ?",
    "options": [
      "Il permet de calculer la prime de risque exacte",
      "Il mod√©lise un comportement cyclique des actifs",
      "Il repr√©sente un al√©a continu avec des incr√©ments ind√©pendants et normalement distribu√©s",
      "Il est utilis√© uniquement pour les actifs √† revenu fixe"
    ],
    "answer": "Il repr√©sente un al√©a continu avec des incr√©ments ind√©pendants et normalement distribu√©s",
    "explanation": "Le processus de Wiener, ou mouvement brownien, est la base des mod√®les comme Black-Scholes car il mod√©lise une √©volution al√©atoire continue des prix."
  },
  {
    "question": "Quelle m√©thode est typiquement utilis√©e pour calibrer une surface de volatilit√© implicite ?",
    "options": [
      "Lissage par moyenne mobile",
      "Interpolation et optimisation num√©rique √† partir de prix d‚Äôoptions",
      "R√©gression lin√©aire sur les prix spot",
      "Transformation de Fourier inverse des prix d‚Äôoptions"
    ],
    "answer": "Interpolation et optimisation num√©rique √† partir de prix d‚Äôoptions",
    "explanation": "La calibration consiste √† extraire les volatilit√©s implicites du march√© via interpolation puis √† ajuster un mod√®le √† l‚Äôaide d‚Äôune m√©thode d‚Äôoptimisation."
  },
  {
    "question": "Quelle est la diff√©rence majeure entre Monte Carlo et arbre binomial dans le pricing d‚Äôoptions ?",
    "options": [
      "Monte Carlo est plus rapide que l‚Äôarbre binomial",
      "L‚Äôarbre binomial est plus adapt√© aux options exotiques",
      "Monte Carlo g√®re mieux les options complexes √† plusieurs variables",
      "Les deux m√©thodes sont √©quivalentes en termes d‚Äôapplication"
    ],
    "answer": "Monte Carlo g√®re mieux les options complexes √† plusieurs variables",
    "explanation": "La m√©thode de Monte Carlo est id√©ale pour des options exotiques ou multidimensionnelles, contrairement aux arbres binomiaux, plus adapt√©s aux options simples."
  },
  {
    "question": "Quel est le r√¥le principal de la matrice de corr√©lation en gestion de portefeuille ?",
    "options": [
      "Mesurer le rendement attendu des actifs",
      "Identifier les relations de d√©pendance entre les actifs",
      "Optimiser la fiscalit√© du portefeuille",
      "D√©terminer la volatilit√© historique individuelle"
    ],
    "answer": "Identifier les relations de d√©pendance entre les actifs",
    "explanation": "La matrice de corr√©lation aide √† comprendre comment les actifs √©voluent ensemble, ce qui est crucial pour la diversification du risque."
  },
  {
    "question": "Dans un mod√®le de Black-Scholes, quelle hypoth√®se est faite sur la volatilit√© ?",
    "options": [
      "Elle est nulle",
      "Elle varie en fonction du temps",
      "Elle est constante",
      "Elle suit une loi normale"
    ],
    "answer": "Elle est constante",
    "explanation": "Le mod√®le Black-Scholes suppose une volatilit√© constante sur toute la dur√©e de vie de l‚Äôoption, bien que cela soit une simplification."
  },
  {
    "question": "Pourquoi utilise-t-on le changement de mesure en probabilit√©s neutres au risque ?",
    "options": [
      "Pour ignorer le temps dans les calculs de prix",
      "Pour √©viter de devoir estimer la volatilit√©",
      "Pour valoriser les actifs en supprimant la prime de risque",
      "Pour simuler des sc√©narios plus pessimistes"
    ],
    "answer": "Pour valoriser les actifs en supprimant la prime de risque",
    "explanation": "Le passage √† une mesure neutre au risque permet de valoriser les actifs en rempla√ßant les esp√©rances r√©elles par celles sous mesure risque-neutre."
  },
  {
    "question": "Qu‚Äôindique un Sharpe Ratio n√©gatif sur une p√©riode donn√©e ?",
    "options": [
      "Le portefeuille a surperform√© le march√©",
      "La volatilit√© du portefeuille est faible",
      "La performance est inf√©rieure au taux sans risque",
      "Le portefeuille est parfaitement diversifi√©"
    ],
    "answer": "La performance est inf√©rieure au taux sans risque",
    "explanation": "Un Sharpe Ratio n√©gatif signifie que le rendement exc√©dentaire est n√©gatif, c‚Äôest-√†-dire inf√©rieur au rendement sans risque malgr√© la prise de risque."
  }, 

  ]
};

// Timer
const Timer = ({ timeLeft }) => (
  <p className="timer">‚è≥ Temps restant : <span>{timeLeft}s</span></p>
);

// Composant QCM
const QuestionCard = ({ question, options, onAnswerClick, timeLeft }) => (
  <div className="question-card">
    <h4>üí° {question}</h4>
    <Timer timeLeft={timeLeft} />
    <div className="options-container">
      {options.map((option, index) => (
        <button key={index} onClick={() => onAnswerClick(option)} className="option-button">
          {index + 1}. {option}
        </button>
      ))}
    </div>
  </div>
);

// Composant Flashcard
const Flashcard = ({ slide, index, total }) => (
  <div className="question-card" style={{ fontSize: '14px', margin: '0' }}>
    {/* <h5>üß† Flashcard {index + 1} / {total}</h5> */}
    <strong>Question :</strong>
    <pre style={{ margin: '0', padding: '4px', background: '#f5f5f5', borderRadius: '3px', overflowX: 'auto' }}>
      <code style={{ fontFamily: 'monospace', whiteSpace: 'pre-wrap', lineHeight: '0.4' }}>
        {slide.question}
      </code>
    
    </pre>
    <strong>R√©ponse :</strong> {slide.answer}
  </div>
);




// Composant R√©sultat
const Results = ({ scores }) => {
  const totalScore = scores.moyen + scores.avance;
  const totalQuestions = Object.values(questions).flat().length;
  return (
    <div className="results">
      <h3>üéØ Score final : {totalScore} / {totalQuestions}</h3>
      <p>‚úÖ Niveau Moyen : {scores.moyen}</p>
      <p>‚úÖ Niveau Avanc√© : {scores.avance}</p>
      {totalScore > 3 ? (
        <h3 className="success">üöÄ Excellent travail ! Vous ma√Ætrisez bien les Produits !</h3>
      ) : (
        <p className="fail">üìö R√©visez encore un peu pour bien comprendre les concepts, ou retournez voir les flashcards !</p>
      )}
    </div>
  );
};

// Page principale
const OOp_Python = () => {
  const [level, setLevel] = useState("basic");
  const [currentSlide, setCurrentSlide] = useState(0);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [scores, setScores] = useState({ moyen: 0, avance: 0 });
  const [timeLeft, setTimeLeft] = useState(20);
  const [showResult, setShowResult] = useState(false);
  const [message, setMessage] = useState("");

  // Timer pour les niveaux QCM
  useEffect(() => {
    if (level !== "basic" && !showResult && timeLeft > 0) {
      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
      return () => clearTimeout(timer);
    } else if (level !== "basic" && timeLeft === 0) {
      handleNextQuestion();
    }
  }, [timeLeft, level, showResult]);

  // Slide auto pour les flashcards
  useEffect(() => {
    if (level === "basic" && !showResult) {
      const interval = setInterval(() => {
        setCurrentSlide((prev) => {
          if (prev + 1 < basicSlides.length) {
            return prev + 1;
          } else {
            setLevel("moyen");
            setCurrentQuestion(0);
            setTimeLeft(20);
            return 0;
          }
        });
      }, 10000);
      return () => clearInterval(interval);
    }
  }, [level, showResult]);

  const handleAnswerClick = (option) => {
    const currentQuestions = questions[level];
    const current = currentQuestions[currentQuestion];
    if (option === current.answer) {
      setScores((prevScores) => ({ ...prevScores, [level]: prevScores[level] + 1 }));
      setMessage("‚úÖ Correct !");
    } else {
      setMessage(`‚ùå Incorrect ! La bonne r√©ponse √©tait : ${current.answer}\n ‚ÑπÔ∏è ${current.explanation}`);
    }
    setTimeout(handleNextQuestion, 2500);
  };

  const handleNextQuestion = () => {
    const currentQuestions = questions[level];
    if (currentQuestion + 1 < currentQuestions.length) {
      setCurrentQuestion(currentQuestion + 1);
      setTimeLeft(20);
      setMessage("");
    } else {
      if (level === "moyen") {
        setLevel("avance");
      } else {
        setShowResult(true);
      }
      setCurrentQuestion(0);
      setTimeLeft(20);
      setMessage("");
    }
  };

  return (
    <div className="qcm-container">
      {showResult ? (
        <Results scores={scores} />
      ) : (
        <div>
          <h4 className="subtitle" style={{ fontSize: '10px', margin: '0' }}>
              Fixed Inc! üîπ Niveau : {level.toUpperCase()}
          </h4>

          {level === "basic" ? (
            <Flashcard slide={basicSlides[currentSlide]} index={currentSlide} total={basicSlides.length} />
          ) : (
            <QuestionCard
              question={questions[level][currentQuestion].question}
              options={questions[level][currentQuestion].options}
              onAnswerClick={handleAnswerClick}
              timeLeft={timeLeft}
            />
          )}

          {message && <p className="message">{message}</p>}
        </div>
      )}
    </div>
  );
};




export default OOp_Python;