// src/projects/Project2/pages/Page1.js

import React, { useState, useEffect } from "react";
import "./Page.css";
// partie 
// Flashcards pour le niveau basic

const basicSlides = [
  {
    "question": "D√©finition d‚Äôun swap + types principaux ?",
    "answer": "**Swap** = contrat d‚Äô√©change de **flux financiers** (taux, devises, rendement...).\nüîπ Types : **IRS**, **Currency Swap**, **Basis Swap**, **TRS**, **Inflation Swap**, **Cross Currency IRS**."
  },
  {
    "question": "Fonctionnement d‚Äôun IRS + formule de calcul ?",
    "answer": "**IRS** = √©change **taux fixe vs taux variable** sur un nominal.\nüîπ Formules :\n- Fixe : `flux = nominal √ó taux fixe √ó p√©riode`\n- Variable : `flux = nominal √ó taux var √ó p√©riode`"
  },
  {
    "question": "Objectifs d‚Äôun swap + exemple d‚Äôutilisation ?",
    "answer": "**Utilit√©s** : **hedging**, **sp√©culation**, **arbitrage**, ou ajustement de bilan.\nüîπ Ex : A veut stabilit√© ‚Üí √©change taux variable contre taux fixe avec B."
  },
  {
    "question": "Diff√©rences IRS vs Currency Swap ?",
    "answer": "**IRS** : m√™me devise, pas de nominal √©chang√©.\n**Currency Swap** : **devises diff√©rentes** + **√©change de nominal** (int√©r√™ts + capital)."
  },
  {
    "question": "Qu‚Äôest-ce qu‚Äôun TRS + √† quoi sert-il ?",
    "answer": "**TRS (Total Return Swap)** = √©change de la **performance d‚Äôun actif** (ex : action) contre un taux fixe ou variable.\nüí° Utilis√© pour s‚Äôexposer √† un actif sans le poss√©der."
  },
  {
    "question": "Quels sont les risques + comment valoriser un swap ?",
    "answer": "**Risques** : taux, change, contrepartie, liquidit√© (souvent OTC).\nüîπ **Valorisation** = VAN obtenue en actualisant les flux avec les **courbes de taux ZC**."
  },
  {
    "question": "D√©finition d‚Äôun equity + types d‚Äôactions ?",
    "answer": "**Equity** = titre de **propri√©t√©** d‚Äôentreprise (actions). Donne droit √† **dividendes**, **vote**, **valeur r√©siduelle**.\nüîπ Types : **ordinaires** (vote + dividende variable), **pr√©f√©rentielles** (dividende fixe, pas de vote), **croissance** (valorisation √©lev√©e), **rendement** (dividendes r√©guliers)."
  },
  {
    "question": "Dividendes + dilution d‚Äôactions : explication ?",
    "answer": "**Dividende** = part du b√©n√©fice redistribu√©e (non garantie).\n**Dilution** = perte de part relative apr√®s √©mission de nouvelles actions.\nüìå Exemple : √©mission de 1M actions ‚Üí chaque action existante repr√©sente une part plus faible."
  },
  {
    "question": "Split, regroupement + augmentation de capital : effet ?",
    "answer": "**Split** : division des actions (prix ‚Üì, quantit√© ‚Üë).\n**Regroupement** : fusion d‚Äôactions (prix ‚Üë, quantit√© ‚Üì).\n**Augmentation de capital** : nouvelle √©mission ‚Üí **dilution possible**."
  },
  {
    "question": "Indicateurs cl√©s pour analyser une action ?",
    "answer": "**PER** = Price/Earnings (valorisation), **BPA (EPS)** = b√©n√©fice/nb d‚Äôactions, **rendement** = dividende/prix, **b√™ta** = sensibilit√© au march√©."
  },
  {
    "question": "Quels produits d√©riv√©s sur actions + usage ?",
    "answer": "**Options**, **futures**, **CFDs**, **swaps**, **forwards** ‚Üí servent √† **couvrir, sp√©culer ou r√©pliquer** la performance d‚Äôun titre sans le poss√©der."
  },
  {
    "question": "Qu‚Äôest-ce qu‚Äôun equity swap + son usage ?",
    "answer": "**Equity Swap** = √©change de la **performance totale** (dividendes + plus-value) contre un **taux fixe/variable**. Utile pour **exposition sans d√©tention r√©elle**."
  },
  {
    "question": "Quels risques sont li√©s aux actions ?",
    "answer": "**Volatilit√©**, **absence de dividende**, **baisse du march√©**, **dilution**, **risque sp√©cifique** (faillite, scandale...)."
  },
  {
    "question": "Exemple concret d‚Äôinvestissement + rendement ?",
    "answer": "Achat 100 actions √† 50 ‚Ç¨ ‚Üí dividende 3 ‚Ç¨ = **rendement 6%**.\nSi vente √† 60 ‚Ç¨, **plus-value = 1000 ‚Ç¨**.\nüìå Exemple : strat√©gie simple de gain en capital + revenu passif."
  },
  {
    "question": "Diff√©rences actions vs obligations et mati√®res premi√®res ?",
    "answer": "**Actions** : rendement √©lev√©, risque √©lev√©. **Obligations** : revenu fixe, risque mod√©r√©. **Mati√®res premi√®res** : volatiles, pas de revenu r√©gulier."
  },
  {
    "question": "Strat√©gies sur actions : exemples ?",
    "answer": "**Buy & Hold** (long terme), **swing trading** (moyen terme), **short selling** (parier √† la baisse), **options** pour couverture (ex : put protecteur)."
  },
  {
    "question": "D√©finition Equity vs Fixed Income + r√©mun√©ration ?",
    "answer": "**Equity** = part de propri√©t√© (actions), r√©mun√©r√©e par **dividendes** + plus-value. **Fixed Income** = titre de dette, r√©mun√©r√© par **coupons r√©guliers** + capital rembours√© √† l‚Äô√©ch√©ance."
  },
  {
    "question": "Exemples de produits Equity et Fixed Income ?",
    "answer": "**Equity** : actions ordinaires/pr√©f√©rentielles, ETFs, options, CFDs. **Fixed Income** : obligations d‚Äô√âtat/corporate, TCN, CDS, futures sur taux."
  },
  {
    "question": "Priorit√© de remboursement + dur√©e des actifs ?",
    "answer": "**Fixed Income** : rembours√© **avant** Equity en cas de faillite. **Equity** = dur√©e **illimit√©e**, **Fixed Income** = dur√©e **d√©finie** (√©ch√©ance connue)."
  },
  {
    "question": "Indicateurs d‚Äôanalyse pour actions vs obligations ?",
    "answer": "**Equity** : PER, BPA, rendement dividende, b√™ta. **Fixed Income** : coupon, YTM, duration, spread de cr√©dit."
  },
  {
    "question": "Exemple investissement en actions + obligations ?",
    "answer": "**Equity** : 100 actions √† 40‚Ç¨, dividende 2‚Ç¨ = rendement 5%. Vente √† 45‚Ç¨ ‚Üí plus-value 500‚Ç¨.\n**Fixed Income** : obligation 1000‚Ç¨, coupon 3% ‚Üí 30‚Ç¨/an + 1000‚Ç¨ √† l‚Äô√©ch√©ance."
  },
  {
    "question": "Risques li√©s aux Equity et Fixed Income ?",
    "answer": "**Equity** : volatilit√©, dividende non garanti, dilution, faillite. **Fixed Income** : taux d‚Äôint√©r√™t, d√©faut de cr√©dit, inflation, liquidit√©."
  },
  {
    "question": "Produits hybrides + strat√©gie portefeuille mixte ?",
    "answer": "**Hybrides** : obligations convertibles, preferred shares, callable bonds, CDS.\n**Portefeuille mixte** : associer **actions pour croissance** et **obligations pour stabilit√©/rendement r√©gulier**."
  },
  {
    "question": "Pourquoi choisir Equity ou Fixed Income ?",
    "answer": "**Equity** : rendement √©lev√©, risque fort, id√©al pour croissance. **Fixed Income** : flux stables, risque plus mod√©r√©, id√©al pour revenu s√©curis√©."
  }
 

];
// QCM pour les niveaux moyen et avanc√©
const questions = {
  moyen:[
  {
    "question": "Quel est le r√¥le principal d‚Äôun swap en finance ?",
    "options": [
      "Acheter un actif √† effet de levier",
      "√âchanger des flux financiers selon des modalit√©s d√©finies",
      "Garantir un rendement fixe",
      "Remplacer un pr√™t bancaire"
    ],
    "answer": "√âchanger des flux financiers selon des modalit√©s d√©finies",
    "explanation": "Un swap est un contrat d√©riv√© o√π deux parties s‚Äô√©changent des flux (taux d‚Äôint√©r√™t, devises, rendement‚Ä¶)."
  },
  {
    "question": "Quel type de swap consiste √† √©changer taux fixe contre taux variable ?",
    "options": [
      "Currency Swap",
      "Interest Rate Swap",
      "Total Return Swap",
      "Credit Default Swap"
    ],
    "answer": "Interest Rate Swap",
    "explanation": "Un Interest Rate Swap (IRS) est un √©change d‚Äôun taux fixe contre un taux variable sur un nominal donn√©."
  },
  {
    "question": "Quel swap inclut un √©change de devises et du nominal ?",
    "options": [
      "Inflation Swap",
      "Basis Swap",
      "Currency Swap",
      "Interest Rate Swap"
    ],
    "answer": "Currency Swap",
    "explanation": "Un Currency Swap implique deux devises diff√©rentes et inclut l‚Äô√©change du nominal et des flux d‚Äôint√©r√™ts."
  },
  {
    "question": "Quelle formule permet de calculer un flux de taux fixe dans un IRS ?",
    "options": [
      "Flux = Nominal √ó taux variable √ó p√©riode",
      "Flux = taux ref √ó p√©riode",
      "Flux = Nominal √ó taux fixe √ó p√©riode",
      "Flux = taux fixe √∑ nominal"
    ],
    "answer": "Flux = Nominal √ó taux fixe √ó p√©riode",
    "explanation": "Le calcul du flux fixe utilise la formule : nominal √ó taux fixe √ó dur√©e entre les √©ch√©ances."
  },
  {
    "question": "Pourquoi une entreprise utiliserait-elle un IRS ?",
    "options": [
      "Pour augmenter sa marge brute",
      "Pour convertir sa dette en devise √©trang√®re",
      "Pour sp√©culer sur les taux de change",
      "Pour stabiliser ses charges d‚Äôint√©r√™t"
    ],
    "answer": "Pour stabiliser ses charges d‚Äôint√©r√™t",
    "explanation": "Un IRS est souvent utilis√© pour passer d‚Äôun taux variable √† un taux fixe afin de s√©curiser les co√ªts futurs."
  },
  {
    "question": "Dans un Total Return Swap (TRS), que re√ßoit l‚Äôune des parties ?",
    "options": [
      "Un flux index√© sur l‚Äôinflation",
      "Un taux fixe uniquement",
      "Le rendement total d‚Äôun actif (dividendes + plus-values)",
      "Un taux fixe contre un nominal"
    ],
    "answer": "Le rendement total d‚Äôun actif (dividendes + plus-values)",
    "explanation": "Un TRS permet de recevoir le rendement complet d‚Äôun actif sans en poss√©der la propri√©t√©."
  },
  {
    "question": "Quel risque principal un swap de taux cherche-t-il √† couvrir ?",
    "options": [
      "Le risque de liquidit√©",
      "Le risque de cr√©dit",
      "Le risque de taux d‚Äôint√©r√™t",
      "Le risque fiscal"
    ],
    "answer": "Le risque de taux d‚Äôint√©r√™t",
    "explanation": "Le but d‚Äôun IRS est de se prot√©ger contre les fluctuations futures des taux d‚Äôint√©r√™t (hausse ou baisse)."
  },
  {
    "question": "Quelle caract√©ristique distingue un Basis Swap ?",
    "options": [
      "Il √©change un taux fixe contre un taux flottant",
      "Il convertit une devise en une autre",
      "Il √©change deux taux variables de r√©f√©rence diff√©rents",
      "Il inclut le transfert du nominal"
    ],
    "answer": "Il √©change deux taux variables de r√©f√©rence diff√©rents",
    "explanation": "Un Basis Swap consiste √† √©changer deux taux variables (ex : Euribor 3M contre Euribor 6M)."
  },
  {
    "question": "Quel swap est le mieux adapt√© pour couvrir l‚Äôinflation ?",
    "options": [
      "Currency Swap",
      "Interest Rate Swap",
      "Inflation Swap",
      "TRS"
    ],
    "answer": "Inflation Swap",
    "explanation": "Un Inflation Swap permet d‚Äô√©changer un taux fixe contre un taux index√© √† l‚Äôinflation (ex : IPC France)."
  },
  {
    "question": "Quelle est la nature juridique d‚Äôun swap ?",
    "options": [
      "Action cot√©e",
      "Contrat d‚Äôassurance",
      "Instrument structur√© passif",
      "Contrat d√©riv√©"
    ],
    "answer": "Contrat d√©riv√©",
    "explanation": "Les swaps sont des **contrats d√©riv√©s** : leur valeur d√©pend de la variation d‚Äôun ou plusieurs sous-jacents (taux, devises, etc.)."
  },
  
],
  avance:
   [
  {
    "question": "Quelle est la diff√©rence fondamentale entre une action (equity) et une obligation (fixed income) ?",
    "options": [
      "Les deux sont des dettes",
      "L'action donne un droit de propri√©t√©, l'obligation est un pr√™t",
      "Les actions ont un coupon garanti",
      "Les obligations permettent de voter en AG"
    ],
    "answer": "L'action donne un droit de propri√©t√©, l'obligation est un pr√™t",
    "explanation": "Les actions (equity) repr√©sentent une part dans l‚Äôentreprise, alors que les obligations sont un pr√™t contract√© par l‚Äô√©metteur envers l‚Äôinvestisseur."
  },
  {
    "question": "Quel produit appartient √† la cat√©gorie Fixed Income ?",
    "options": [
      "Actions ordinaires",
      "Options sur actions",
      "Obligations d‚Äô√âtat",
      "Futures sur indices"
    ],
    "answer": "Obligations d‚Äô√âtat",
    "explanation": "Les obligations d‚Äô√âtat font partie des titres √† revenu fixe car elles versent des coupons √† √©ch√©ance r√©guli√®re."
  },
  {
    "question": "Quelle est la principale source de revenu d‚Äôun investisseur en actions ?",
    "options": [
      "Coupons fixes",
      "Plus-value et dividendes variables",
      "Remboursement du nominal",
      "Frais d‚Äô√©mission"
    ],
    "answer": "Plus-value et dividendes variables",
    "explanation": "Les actions offrent un revenu par dividendes et un potentiel de plus-value si le cours monte, mais ces revenus ne sont pas garantis."
  },
  {
    "question": "Quel indicateur permet d‚Äô√©valuer la sensibilit√© d'une obligation aux taux ?",
    "options": [
      "B√™ta",
      "PER",
      "Spread",
      "Duration"
    ],
    "answer": "Duration",
    "explanation": "La duration mesure la sensibilit√© du prix d'une obligation aux variations des taux d‚Äôint√©r√™t."
  },
  {
    "question": "Quelle est la priorit√© de remboursement entre equity et fixed income en cas de faillite ?",
    "options": [
      "Les actionnaires sont rembours√©s en premier",
      "Les cr√©anciers obligataires passent avant les actionnaires",
      "Tous sont trait√©s √† √©galit√©",
      "Les d√©tenteurs de futures sont prioritaires"
    ],
    "answer": "Les cr√©anciers obligataires passent avant les actionnaires",
    "explanation": "En cas de faillite, les cr√©anciers (obligataires) sont prioritaires sur les actionnaires dans l‚Äôordre de remboursement."
  },
  {
    "question": "Qu‚Äôest-ce qu‚Äôun equity swap ?",
    "options": [
      "L‚Äôachat d‚Äôune obligation convertible",
      "Un pr√™t interbancaire",
      "L‚Äô√©change de performance d‚Äôune action contre un taux",
      "Une fusion entre deux actions"
    ],
    "answer": "L‚Äô√©change de performance d‚Äôune action contre un taux",
    "explanation": "Un equity swap permet √† une partie de recevoir la performance d'une action (plus-value + dividende) contre un taux fixe ou variable."
  },
  {
    "question": "Quel indicateur √©value la valorisation d‚Äôune action par rapport √† son b√©n√©fice ?",
    "options": [
      "PER",
      "EPS",
      "YTM",
      "Spread de cr√©dit"
    ],
    "answer": "PER",
    "explanation": "Le Price/Earnings Ratio (PER) compare le prix de l‚Äôaction √† son b√©n√©fice annuel, utile pour mesurer la valorisation relative."
  },
  {
    "question": "Quel risque est plus sp√©cifique aux obligations qu‚Äôaux actions ?",
    "options": [
      "Volatilit√© des prix",
      "Risque de d√©faut de l‚Äô√©metteur",
      "Dilution",
      "Risque sectoriel"
    ],
    "answer": "Risque de d√©faut de l‚Äô√©metteur",
    "explanation": "Les obligations sont expos√©es au risque de **d√©faut de paiement** de l‚Äô√©metteur, ce qui est moins direct pour une action."
  },
  {
    "question": "Pourquoi investir dans une obligation plut√¥t qu‚Äôune action ?",
    "options": [
      "Pour un revenu variable",
      "Pour voter en assembl√©e",
      "Pour un revenu plus stable",
      "Pour une croissance rapide"
    ],
    "answer": "Pour un revenu plus stable",
    "explanation": "Les obligations offrent des **coupons r√©guliers**, donc un revenu plus pr√©visible que les actions, au prix d‚Äôun potentiel de gain plus limit√©."
  },
  {
    "question": "Quel est un exemple de produit hybride entre equity et fixed income ?",
    "options": [
      "ETF sur mati√®res premi√®res",
      "Obligation z√©ro-coupon",
      "Obligation convertible",
      "Option call classique"
    ],
    "answer": "Obligation convertible",
    "explanation": "Une obligation convertible peut √™tre transform√©e en actions, combinant **revenu fixe initial** et **potentiel de croissance** via l‚Äôaction."
  }
]

};


// Timer
const Timer = ({ timeLeft }) => (
  <p className="timer">‚è≥ Temps restant : <span>{timeLeft}s</span></p>
);

// Composant QCM
const QuestionCard = ({ question, options, onAnswerClick, timeLeft }) => (
  <div className="question-card">
    <h4>üí° {question}</h4>
    <Timer timeLeft={timeLeft} />
    <div className="options-container">
      {options.map((option, index) => (
        <button key={index} onClick={() => onAnswerClick(option, index)} className="option-button">
          {String.fromCharCode(65 + index)}.{option}
        </button>
      ))}
    </div>
  </div>
);

// Composant Flashcard
const Flashcard = ({ slide, index, total }) => (
  <div className="question-card" style={{ fontSize: '14px', margin: '0' }}>
    {/* <h5>üß† Flashcard {index + 1} / {total}</h5> */}
    <strong>Question : </strong>
    
    <strong>
      <p>
        <code style={{ fontFamily: 'monospace', whiteSpace: 'pre-wrap', lineHeight: '0.4' }}>
          {slide.question}
        </code>
      </p>
    </strong>  
      <pre style={{ margin: '0', padding: '2px', background: '#f5f5f5', borderRadius: '3px', overflowX: 'auto' }}>
        <p>
          <strong>R√©ponse :</strong> {slide.answer}
        </p>
      </pre>
  </div>
);




// Composant R√©sultat
const Results = ({ scores }) => {
  const totalScore = scores.moyen + scores.avance;
  const totalQuestions = Object.values(questions).flat().length;
  return (
    <div className="results">
      <h3>üéØ Score final : {totalScore} / {totalQuestions}</h3>
      <p>‚úÖ Niveau Moyen : {scores.moyen}</p>
      <p>‚úÖ Niveau Avanc√© : {scores.avance}</p>
      {totalScore > 3 ? (
        <h3 className="success">üöÄ Excellent travail ! Vous ma√Ætrisez bien les Produits !</h3>
      ) : (
        <p className="fail">üìö R√©visez encore un peu pour bien comprendre les concepts, ou retournez voir les flashcards !</p>
      )}
    </div>
  );
};

// Page principale
const Page3 = () => {
  const [level, setLevel] = useState("basic");
  const [currentSlide, setCurrentSlide] = useState(0);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [scores, setScores] = useState({ moyen: 0, avance: 0 });
  const [timeLeft, setTimeLeft] = useState(20);
  const [showResult, setShowResult] = useState(false);
  const [message, setMessage] = useState("");

  // Timer pour les niveaux QCM
  useEffect(() => {
    if (level !== "basic" && !showResult && timeLeft > 0) {
      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
      return () => clearTimeout(timer);
    } else if (level !== "basic" && timeLeft === 0) {
      handleNextQuestion();
    }
  }, [timeLeft, level, showResult]);

  // Slide auto pour les flashcards
  useEffect(() => {
    if (level === "basic" && !showResult) {
      const interval = setInterval(() => {
        setCurrentSlide((prev) => {
          if (prev + 1 < basicSlides.length) {
            return prev + 1;
          } else {
            setLevel("moyen");
            setCurrentQuestion(0);
            setTimeLeft(20);
            return 0;
          }
        });
      }, 10000);
      return () => clearInterval(interval);
    }
  }, [level, showResult]);

const handleAnswerClick = (option, index) => {
  const currentQuestions = questions[level];
  const current = currentQuestions[currentQuestion];
  const correctAnswer = current.answer;

  const isCorrect =
    /^[A-D]$/.test(correctAnswer) // Si c‚Äôest une lettre
      ? index === correctAnswer.charCodeAt(0) - 65
      : option === correctAnswer; // Sinon compare le texte

  if (isCorrect) {
    setScores((prevScores) => ({ ...prevScores, [level]: prevScores[level] + 1 }));
    setMessage("‚úÖ Correct !");
  } else {
    setMessage(`‚ùå Incorrect ! La bonne r√©ponse √©tait : ${correctAnswer}\n ‚ÑπÔ∏è ${current.explanation}`);
  }

  setTimeout(handleNextQuestion, 2500);
};

  const handleNextQuestion = () => {
    const currentQuestions = questions[level];
    if (currentQuestion + 1 < currentQuestions.length) {
      setCurrentQuestion(currentQuestion + 1);
      setTimeLeft(20);
      setMessage("");
    } else {
      if (level === "moyen") {
        setLevel("avance");
      } else {
        setShowResult(true);
      }
      setCurrentQuestion(0);
      setTimeLeft(20);
      setMessage("");
    }
  };

  return (
    <div className="qcm-container">
      {showResult ? (
        <Results scores={scores} />
      ) : (
        <div>
          <h4 className="subtitle" style={{ fontSize: '10px', margin: '0' }}>
              Fixed Inc! üîπ Niveau : {level.toUpperCase()}
          </h4>

          {level === "basic" ? (
            <Flashcard slide={basicSlides[currentSlide]} index={currentSlide} total={basicSlides.length} />
          ) : (
            <QuestionCard
              question={questions[level][currentQuestion].question}
              options={questions[level][currentQuestion].options}
              onAnswerClick={handleAnswerClick}
              timeLeft={timeLeft}
            />
          )}

          {message && <p className="message">{message}</p>}
        </div>
      )}
    </div>
  );
};


export default Page3;